<!DOCTYPE html>
<html lang="en">
<head>
  <title>Model Viewer with Video Texture</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script async src="https://ga.jspm.io/npm:es-module-shims@1.6.3/dist/es-module-shims.js"></script>
  <script type="importmap-shim">
  {
    "imports": {
      "three": "./model-viewer-301.min.js"
    }
  }
  </script>
  <script type="module-shim" src="model-viewer-301.min.js"></script>
</head>
<body>
  <model-viewer id="animated" src="all.glb" ar ar-modes="webxr scene-viewer" camera-controls>
    <button slot="ar-button" id="ar-button">View in AR</button>
  </model-viewer>

  <script type="module">
    const modelViewer = document.getElementById("animated");

    modelViewer.addEventListener("load", async () => {
      console.log("Model Loaded!");

      if (!modelViewer.model || !modelViewer.model.materials.length) {
        console.error("No materials found on the model.");
        return;
      }

      // Create a video element
      const video = document.createElement("video");
      video.src = "./Tiger.mp4"; // Ensure this path is correct
      video.crossOrigin = "anonymous";
      video.loop = true;
      video.muted = true;
      video.setAttribute("playsinline", ""); // Required for iOS
      video.setAttribute("autoplay", ""); // Helps with autoplay issues
      video.load();

      // Ensure video plays after user interaction (iOS requires user input)
      document.body.addEventListener("click", () => {
        if (video.paused) {
          video.play().catch(e => console.error("Video play error:", e));
        }
      });

      // Create a video texture
      const videoTexture = await modelViewer.createVideoTexture(video);

      // Apply the video texture to the first material
      const material = modelViewer.model.materials[0];
      material.pbrMetallicRoughness.baseColorTexture.setTexture(videoTexture);
      console.log("Video texture applied successfully.");
    });
  </script>
</body>
</html>
