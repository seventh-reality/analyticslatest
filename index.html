<!DOCTYPE html>
<html>
<head>
  <script type="module" src="https://unpkg.com/@google/model-viewer@3.1.1/dist/model-viewer.min.js"></script>
  <title>USDZ + Green Screen AR</title>
  <style>
    body { margin: 0; overflow: hidden; }
    model-viewer { width: 100vw; height: 100vh; }
    #video-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }
  </style>
</head>
<body>
  <!-- Green Screen Video Background -->
  <video id="video-bg" autoplay loop muted>
    <source src="Tiger.mp4" type="video/mp4">
  </video>

  <!-- Model-Viewer for USDZ -->
  <model-viewer
    src="all.usdz"
    ar
    ar-modes="webxr scene-viewer quick-look"
    camera-controls
    environment-image="neutral"
    shadow-intensity="1"
  >
    <button slot="ar-button" style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);">
      View in AR
    </button>
  </model-viewer>

  <!-- Chroma Key Effect (Green Screen Removal) -->
  <script>
    const video = document.getElementById('video-bg');
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    function applyChromaKey() {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;

      for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];

        // Remove green pixels (adjust threshold as needed)
        if (g > 150 && r < 100 && b < 100) {
          data[i + 3] = 0; // Set alpha to 0 (transparent)
        }
      }

      ctx.putImageData(imageData, 0, 0);
      video.style.display = 'none';
      document.body.style.background = `url(${canvas.toDataURL()})`;
      requestAnimationFrame(applyChromaKey);
    }

    video.addEventListener('loadeddata', () => {
      applyChromaKey();
    });
  </script>
</body>
</html>
